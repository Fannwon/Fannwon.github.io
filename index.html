<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>全功能音乐播放器 | GitHub Pages</title>
    <!-- APlayer 样式 -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer@1.10.1/dist/APlayer.min.css">
    <style>
        /* 基础样式 */
        body {
            margin: 0;
            padding: 20px;
            background: #f8f9fa;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        }

        /* 桌面端播放器样式 */
        .aplayer {
            max-width: 800px;
            margin: 20px auto;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        /* 移动端适配 */
        @media (max-width: 768px) {
            body { padding: 10px; }
            
            .aplayer {
                border-radius: 0 !important;
                margin: 0;
                max-width: 100%;
            }
            
            /* 固定模式优化 */
            .aplayer.aplayer-fixed {
                bottom: 0 !important;
                left: 0 !important;
                right: 0 !important;
                width: 100% !important;
            }
        }

        /* 解锁按钮样式 */
        #unlock-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            padding: 12px 24px;
            background: #FF6B6B;
            color: white;
            border: none;
            border-radius: 30px;
            cursor: pointer;
            z-index: 999;
            box-shadow: 0 4px 12px rgba(255,107,107,0.3);
            transition: all 0.3s ease;
        }
        #unlock-btn:hover { transform: scale(1.05); }
    </style>
</head>
<body>
    <!-- 自动播放引导按钮 -->
    <button id="unlock-btn" onclick="unlockAudio()">🎵 点击开始音乐之旅</button>
    
    <!-- 播放器容器 -->
    <div id="player"></div>

    <!-- 依赖库 -->
    <script src="https://cdn.jsdelivr.net/npm/aplayer@1.10.1/dist/APlayer.min.js"></script>
    
    <!-- 配置脚本 -->
    <script>
        // ========== 播放列表配置 ========== //
        const playlist = [
            {
                name: '示情',
                artist: '范文芳',
                url: 'music/范文芳 - 示情.mp3',
                cover: 'covers/nature.jpg',
                lrc: 'lyrics/summer.lrc'  // 可选歌词
            },
            {
                name: '城市夜晚',
                artist: '电子脉搏',
                url: 'music/city_night.mp3',
                cover: 'covers/city.jpg',
                theme: '#2196F3'  // 单曲自定义主题色
            },
            {
                name: '钢琴独奏',
                artist: '古典精选',
                url: 'music/piano_solo.mp3',
                cover: 'covers/piano.jpg'
            }
        ].sort(() => Math.random() - 0.5);  // 初始随机排序

        // ========== 播放器初始化 ========== //
        const ap = new APlayer({
            container: document.getElementById('player'),
            audio: playlist,
            fixed: true,        // 固定模式
            mini: window.innerWidth < 768,  // 自动切换迷你模式
            autoplay: true,    // 自动播放（需用户交互后生效）
            loop: 'all',       // 循环模式：all | one | none
            order: 'random',   // 播放顺序：random | list
            volume: 0.8,       // 初始音量
            theme: '#FF6B6B',  // 主色调
            lrcType: 3         // 歌词解析模式
        });

        // ========== 自动播放解锁 ========== //
        function unlockAudio() {
            ap.play();
            document.getElementById('unlock-btn').style.display = 'none';
            // 请求通知权限（可选）
            if (Notification.permission !== 'denied') {
                Notification.requestPermission();
            }
        }

        // ========== 响应式监听 ========== //
        window.addEventListener('resize', () => {
            ap.mini = window.innerWidth < 768;
        });

        // ========== 播放状态记忆 ========== //
        window.addEventListener('beforeunload', () => {
            localStorage.setItem('last-played', JSON.stringify({
                index: ap.list.index,
                time: ap.audio.currentTime
            }));
        });

        // 读取播放状态
        const lastPlay = JSON.parse(localStorage.getItem('last-played'));
        if (lastPlay) {
            ap.list.switch(lastPlay.index);
            ap.audio.currentTime = lastPlay.time;
        }

        // ========== 桌面通知 ========== //
        ap.on('play', () => {
            if (Notification.permission === 'granted') {
                new Notification('正在播放', {
                    body: `${ap.audio.name} - ${ap.audio.author}`,
                    icon: ap.audio.cover
                });
            }
        });
    </script>
</body>
</html>